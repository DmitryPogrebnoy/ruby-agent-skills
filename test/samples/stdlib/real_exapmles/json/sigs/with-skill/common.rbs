# Type definitions for JSON common.rb

module JSON
  # Type alias for JSON values (result of parsing)
  type json_value = nil | bool | Integer | Float | String | Array[json_value] | Hash[String, json_value]

  # Type alias for objects that can be converted to String
  interface _ToStr
    def to_str: () -> String
  end

  # Type alias for objects that can be converted to IO
  interface _ToIO
    def to_io: () -> IO
  end

  # Type alias for readable objects
  interface _Readable
    def read: () -> String?
  end

  # Type alias for writable objects
  interface _Writable
    def write: (String) -> Integer
  end

  # Type alias for objects that respond to to_hash
  interface _ToHash
    def to_hash: () -> Hash[Symbol, top]
  end

  # Type alias for objects that respond to to_h
  interface _ToH
    def to_h: () -> Hash[Symbol, top]
  end

  # Type alias for on_load callback
  type on_load_proc = ^(json_value) -> json_value

  # Type alias for parser options - using Hash for flexibility
  type parse_options = Hash[Symbol, top]

  # Type alias for generator options - using Hash for flexibility
  type generate_options = Hash[Symbol, top]

  # Type alias for load default options
  type load_options = Hash[Symbol, top]

  # Type alias for dump default options
  type dump_options = Hash[Symbol, top]

  module ParserOptions
    def self.prepare: (parse_options? opts) -> parse_options?

    private

    def self.object_class_proc: (Class object_class, on_load_proc? on_load) -> on_load_proc
    def self.array_class_proc: (Class array_class, on_load_proc? on_load) -> on_load_proc
    def self.create_additions_proc: (parse_options opts) -> parse_options
    def self.create_additions_warning: () -> void
  end

  # Parser class (defined externally, referenced here)
  class Parser
    def self.parse: (String source, parse_options? opts) -> json_value
  end

  # State class (defined externally, referenced here)
  class State
    def self.new: (?generate_options? opts) -> State
    def self.generate: (top obj, generate_options? opts, IO? io) -> String
    def generate: (top obj, ?IO? io) -> String
    def freeze: () -> self
  end

  # Module for Ext::Parser::Config
  module Ext
    class Parser
      class Config
        def initialize: (parse_options? opts) -> void
        def parse: (String source) -> json_value
        def freeze: () -> self
      end
    end
  end

  NaN: Float
  Infinity: Float
  MinusInfinity: Float

  PARSE_L_OPTIONS: Hash[Symbol, top]
  PRETTY_GENERATE_OPTIONS: Hash[Symbol, top]

  # Base exception for JSON errors
  class JSONError < StandardError
  end

  # Parser error exception
  class ParserError < JSONError
    attr_reader line: Integer?
    attr_reader column: Integer?
  end

  # Nesting too deep error
  class NestingError < ParserError
  end

  # Generator error exception
  class GeneratorError < JSONError
    attr_reader invalid_object: top?

    def initialize: (?String message, ?top? invalid_object) -> void
    def detailed_message: (**top) -> String
  end

  # Fragment class for including raw JSON
  class Fragment < Struct[String]
    attr_reader json: String

    def self.new: (String | _ToStr json) -> Fragment
    def self.[]: (String | _ToStr json) -> Fragment
    def initialize: (String json) -> void
    def to_json: (?State? state, *top) -> String
  end

  # Instance variables
  @parser: Class
  @generator: Module
  @state: Class
  @unsafe_load_default_options: load_options
  @load_default_options: load_options
  @dump_default_options: dump_options

  # JSON module singleton methods
  def self.deprecation_warning: (String message, ?Integer uplevel) -> void
  def self.[]: (String | _ToStr object, ?parse_options? opts) -> json_value
             | (top object, ?generate_options? opts) -> String
  attr_reader self.parser: Class
  def self.parser=: (Class parser) -> Class
  def self.generator=: (Module generator) -> Module
  attr_reader self.generator: Module
  attr_accessor self.state: Class
  def self.create_id=: (String? new_value) -> String
  def self.create_id: () -> String

  # Deprecated singleton accessors (generated by deprecated_singleton_attr_accessor)
  def self.unsafe_load_default_options: () -> load_options
  def self.unsafe_load_default_options=: (load_options val) -> load_options
  def self._unsafe_load_default_options: () -> load_options
  def self.load_default_options: () -> load_options
  def self.load_default_options=: (load_options val) -> load_options
  def self._load_default_options: () -> load_options
  def self.dump_default_options: () -> dump_options
  def self.dump_default_options=: (dump_options val) -> dump_options
  def self._dump_default_options: () -> dump_options

  # Private singleton methods
  private

  def self.on_mixed_keys_hash: (Hash[top, top] hash, bool do_raise) -> void
  def self.deprecated_singleton_attr_accessor: (*Symbol attrs) -> void
  def self.const_missing: (Symbol const_name) -> top

  public

  # Module function methods (self?. means both singleton and instance method)
  def self?.parse: (String source, ?parse_options? opts) -> json_value
  def self?.parse!: (String source, ?parse_options? opts) -> json_value
  def self?.load_file: (String filespec, ?parse_options? opts) -> json_value
  def self?.load_file!: (String filespec, ?parse_options? opts) -> json_value
  def self?.generate: (top obj, ?generate_options? | State? opts) -> String
  def self?.fast_generate: (top obj, ?generate_options? opts) -> String
  def self?.pretty_generate: (top obj, ?generate_options? | State? | _ToHash? | _ToH? opts) -> String
  def self?.unsafe_load: (String | _ToStr | _ToIO | _Readable source, ?^(json_value) -> void | load_options? proc, ?load_options? options) -> json_value
  def self?.load: (String | _ToStr | _ToIO | _Readable source, ?^(json_value) -> void | load_options? proc, ?load_options? options) -> json_value
  def self?.dump: (top obj, ?IO | _ToIO | _Writable | Integer | dump_options? anIO, ?Integer | dump_options? limit, ?dump_options? kwargs) -> String

  # Deprecated methods (using ... forwarding)
  def self?.unparse: (top obj, ?generate_options? opts) -> String
  def self?.fast_unparse: (top obj, ?generate_options? opts) -> String
  def self?.pretty_unparse: (top obj, ?generate_options? | State? | _ToHash? | _ToH? opts) -> String
  def self?.restore: (String | _ToStr | _ToIO | _Readable source, ?^(json_value) -> void | load_options? proc, ?load_options? options) -> json_value

  # JSON::Coder class
  class Coder
    @state: State
    @parser_config: Ext::Parser::Config

    def initialize: (?generate_options? options) ?{ (top) -> json_value } -> void
    def dump: (top object, ?IO? io) -> String
    alias generate dump
    def load: (String source) -> json_value
    alias parse load
    def load_file: (String path) -> json_value
  end
end

module Kernel
  private

  def j: (*top objs) -> nil
  def jj: (*top objs) -> nil
  def JSON: (String | top object, ?Hash[Symbol, top]? opts) -> (JSON::json_value | String)
end
